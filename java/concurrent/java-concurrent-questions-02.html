<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta name="keywords" content="å¤šçº¿ç¨‹,æ­»é”,synchronized,ReentrantLock,volatile,ThreadLocal,çº¿ç¨‹æ± ,CAS,AQS"><meta name="description" content="Javaå¹¶å‘å¸¸è§çŸ¥è¯†ç‚¹å’Œé¢è¯•é¢˜æ€»ç»“ï¼ˆå«è¯¦ç»†è§£ç­”ï¼‰ã€‚"><meta property="og:url" content="https://ByteInvoker.github.io/java/concurrent/java-concurrent-questions-02.html"><meta property="og:site_name" content="Invoker"><meta property="og:title" content="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰"><meta property="og:description" content="JMM(Java å†…å­˜æ¨¡å‹) JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œäºæ˜¯æˆ‘å•ç‹¬æŠ½äº†ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ JMM ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œé—®é¢˜ï¼š ã€‚ volatile å…³é”®å­— å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Ÿ åœ¨ Java ä¸­ï¼Œvolatile å…³é”®å­—å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œå¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º volatile ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯..."><meta property="og:type" content="article"><meta property="og:image" content="https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-22T10:07:34.000Z"><meta property="article:author" content="Invoker"><meta property="article:tag" content="Javaå¹¶å‘"><meta property="article:modified_time" content="2024-03-22T10:07:34.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰","image":["https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm2.png","https://oss.javaguide.cn/github/javaguide/java/JUC%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%A6%82%E8%A7%88-20230814005211968.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-principle.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-get-lock-code-block.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-release-lock-block.png","https://oss.javaguide.cn/github/javaguide/synchronized%E5%85%B3%E9%94%AE%E5%AD%97%E5%8E%9F%E7%90%862.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/reentrantlock-class-diagram.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/reentrantreadwritelock-class-diagram.png"],"dateModified":"2024-03-22T10:07:34.000Z","author":[{"@type":"Person","name":"Invoker","url":"https://ByteInvoker.github.io"}]}</script><link rel="icon" href="/head1.jpeg"><title>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰ | Invoker</title>
    <link rel="preload" href="/assets/style-BfXXjxCq.css" as="style"><link rel="stylesheet" href="/assets/style-BfXXjxCq.css">
    <link rel="modulepreload" href="/assets/app-Diq65XQm.js"><link rel="modulepreload" href="/assets/java-concurrent-questions-02.html-BcHJBxbu.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DTtH8pqq.js" as="script"><link rel="prefetch" href="/assets/intro.html-BDcRwpph.js" as="script"><link rel="prefetch" href="/assets/index.html-B9yHBpr_.js" as="script"><link rel="prefetch" href="/assets/intro.html-FL0RC6FS.js" as="script"><link rel="prefetch" href="/assets/index.html-Cv_d-y17.js" as="script"><link rel="prefetch" href="/assets/disable.html-CvANZUgc.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-BSqqGL1n.js" as="script"><link rel="prefetch" href="/assets/layout.html-D18Tnhiu.js" as="script"><link rel="prefetch" href="/assets/markdown.html-Cq1FRsnz.js" as="script"><link rel="prefetch" href="/assets/page.html-Cup9T-ri.js" as="script"><link rel="prefetch" href="/assets/cherry.html-C7vIzaUJ.js" as="script"><link rel="prefetch" href="/assets/dragonfruit.html-BS_vIzjM.js" as="script"><link rel="prefetch" href="/assets/strawberry.html-Cu7W44Gu.js" as="script"><link rel="prefetch" href="/assets/tomato.html-DXZ-D0Tp.js" as="script"><link rel="prefetch" href="/assets/bigdecimal.html-yB27Ww91.js" as="script"><link rel="prefetch" href="/assets/generics-and-wildcards.html-fnjHikTA.js" as="script"><link rel="prefetch" href="/assets/java-basic-questions-01.html-C1l8_KYM.js" as="script"><link rel="prefetch" href="/assets/java-basic-questions-02.html-DQibY99I.js" as="script"><link rel="prefetch" href="/assets/java-basic-questions-03.html-C2g2b3pU.js" as="script"><link rel="prefetch" href="/assets/java-keyword-summary.html-BPdYJklx.js" as="script"><link rel="prefetch" href="/assets/proxy.html-DQ3SCDju.js" as="script"><link rel="prefetch" href="/assets/reflection.html-Cz3mJ-Jz.js" as="script"><link rel="prefetch" href="/assets/serialization.html-V9SUjxKK.js" as="script"><link rel="prefetch" href="/assets/spi.html-C6wI0w0E.js" as="script"><link rel="prefetch" href="/assets/syntactic-sugar.html-BHZtZMdE.js" as="script"><link rel="prefetch" href="/assets/unsafe.html-Dtm3e94C.js" as="script"><link rel="prefetch" href="/assets/why-there-only-value-passing-in-java.html-D6K9cC5O.js" as="script"><link rel="prefetch" href="/assets/arrayblockingqueue-source-code.html-DC3xkX8A.js" as="script"><link rel="prefetch" href="/assets/arraylist-source-code.html-Gl7g5vLm.js" as="script"><link rel="prefetch" href="/assets/concurrent-hash-map-source-code.html-CTlHesJ8.js" as="script"><link rel="prefetch" href="/assets/copyonwritearraylist-source-code.html-68jGrVxo.js" as="script"><link rel="prefetch" href="/assets/delayqueue-source-code.html-CzZYJb8_.js" as="script"><link rel="prefetch" href="/assets/hashmap-source-code.html-kev_Cnsl.js" as="script"><link rel="prefetch" href="/assets/java-collection-precautions-for-use.html-Dymg1tnr.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-01.html-Cf6SEOLi.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-02.html-C-el9mKS.js" as="script"><link rel="prefetch" href="/assets/linkedhashmap-source-code.html-Cv-SUko-.js" as="script"><link rel="prefetch" href="/assets/linkedlist-source-code.html-Uch17_e8.js" as="script"><link rel="prefetch" href="/assets/aqs.html-5XKh9E2s.js" as="script"><link rel="prefetch" href="/assets/atomic-classes.html-DTXcMk7Z.js" as="script"><link rel="prefetch" href="/assets/completablefuture-intro.html-kUehzvJn.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-collections.html-CYQhlhRk.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-01.html-BTCyReUc.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-03.html-BtJRKOke.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-best-practices.html-CCNaBKoi.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-summary.html-DcKA9DTx.js" as="script"><link rel="prefetch" href="/assets/jmm.html-DEuojYrW.js" as="script"><link rel="prefetch" href="/assets/optimistic-lock-and-pessimistic-lock.html-BGwBCQ4n.js" as="script"><link rel="prefetch" href="/assets/reentrantlock.html-BnIaLD2q.js" as="script"><link rel="prefetch" href="/assets/threadlocal.html-l6jb29Cu.js" as="script"><link rel="prefetch" href="/assets/virtual-thread.html-BpH2SQ0-.js" as="script"><link rel="prefetch" href="/assets/io-basis.html-7rsTvtdP.js" as="script"><link rel="prefetch" href="/assets/io-design-patterns.html-Dx4C43Gm.js" as="script"><link rel="prefetch" href="/assets/io-model.html-BcJFAwFk.js" as="script"><link rel="prefetch" href="/assets/nio-basis.html-BAc6xPgf.js" as="script"><link rel="prefetch" href="/assets/class-file-structure.html-CW4m-U-H.js" as="script"><link rel="prefetch" href="/assets/class-loading-process.html-BKofRQpQ.js" as="script"><link rel="prefetch" href="/assets/classloader.html-BBM14fhe.js" as="script"><link rel="prefetch" href="/assets/jdk-monitoring-and-troubleshooting-tools.html-BLHQ1mTE.js" as="script"><link rel="prefetch" href="/assets/jvm-garbage-collection.html-BmGav-tz.js" as="script"><link rel="prefetch" href="/assets/jvm-in-action.html-Cp4CBZal.js" as="script"><link rel="prefetch" href="/assets/jvm-intro.html-FhgbWheu.js" as="script"><link rel="prefetch" href="/assets/jvm-parameters-intro.html-Cko16ela.js" as="script"><link rel="prefetch" href="/assets/memory-area.html-DcVCdfm_.js" as="script"><link rel="prefetch" href="/assets/java10.html-DKh1GBzM.js" as="script"><link rel="prefetch" href="/assets/java11.html-CiF64zQ1.js" as="script"><link rel="prefetch" href="/assets/java12-13.html-Cb6CbGp_.js" as="script"><link rel="prefetch" href="/assets/java14-15.html-CgFjLnpp.js" as="script"><link rel="prefetch" href="/assets/java16.html-BUrg_RpE.js" as="script"><link rel="prefetch" href="/assets/java17.html-W8m86JJ6.js" as="script"><link rel="prefetch" href="/assets/java18.html-F0iCCwrT.js" as="script"><link rel="prefetch" href="/assets/java19.html-C0g3ib9r.js" as="script"><link rel="prefetch" href="/assets/java20.html-BJfTYhXU.js" as="script"><link rel="prefetch" href="/assets/java21.html-Bz4PikxO.js" as="script"><link rel="prefetch" href="/assets/java8-common-new-features.html-DcisIEwe.js" as="script"><link rel="prefetch" href="/assets/java8-tutorial-translate.html-Diy1cyDz.js" as="script"><link rel="prefetch" href="/assets/java9.html-CPcxzeqd.js" as="script"><link rel="prefetch" href="/assets/1.html-nRVRYWXL.js" as="script"><link rel="prefetch" href="/assets/2.html-DgCZ3vwk.js" as="script"><link rel="prefetch" href="/assets/3.html-BNPbCcRC.js" as="script"><link rel="prefetch" href="/assets/4.html-DxdIqPXd.js" as="script"><link rel="prefetch" href="/assets/1.html-BBq1oGLM.js" as="script"><link rel="prefetch" href="/assets/2.html-DVLS0_qZ.js" as="script"><link rel="prefetch" href="/assets/3.html-CTGjPc4k.js" as="script"><link rel="prefetch" href="/assets/4.html-B_x9MJtP.js" as="script"><link rel="prefetch" href="/assets/404.html-DlZZPFpC.js" as="script"><link rel="prefetch" href="/assets/index.html-_kZqNHnG.js" as="script"><link rel="prefetch" href="/assets/index.html-C1TiC3Yg.js" as="script"><link rel="prefetch" href="/assets/index.html-kc4PY_bV.js" as="script"><link rel="prefetch" href="/assets/index.html-tbckZAxS.js" as="script"><link rel="prefetch" href="/assets/index.html-BqP3GdDx.js" as="script"><link rel="prefetch" href="/assets/index.html-CVHC9khn.js" as="script"><link rel="prefetch" href="/assets/index.html-CGtcFu6l.js" as="script"><link rel="prefetch" href="/assets/index.html-D99mB68g.js" as="script"><link rel="prefetch" href="/assets/index.html-Dkn0H6vD.js" as="script"><link rel="prefetch" href="/assets/index.html-yZG6mvDg.js" as="script"><link rel="prefetch" href="/assets/index.html-EJGhCPpP.js" as="script"><link rel="prefetch" href="/assets/index.html-BXEr23Y1.js" as="script"><link rel="prefetch" href="/assets/index.html-3GxwXlTY.js" as="script"><link rel="prefetch" href="/assets/index.html-CcuO-H7x.js" as="script"><link rel="prefetch" href="/assets/index.html-CFvsoqOQ.js" as="script"><link rel="prefetch" href="/assets/index.html-9EKM1el4.js" as="script"><link rel="prefetch" href="/assets/index.html-DGu3EHR7.js" as="script"><link rel="prefetch" href="/assets/index.html-DAcPYm9j.js" as="script"><link rel="prefetch" href="/assets/index.html-BrjwEcwj.js" as="script"><link rel="prefetch" href="/assets/index.html-CcN_N3mW.js" as="script"><link rel="prefetch" href="/assets/index.html-iu6OM5rc.js" as="script"><link rel="prefetch" href="/assets/index.html-UO2g9OXW.js" as="script"><link rel="prefetch" href="/assets/index.html-ChIQNwIO.js" as="script"><link rel="prefetch" href="/assets/index.html-iakrqvsy.js" as="script"><link rel="prefetch" href="/assets/index.html-DaZczSWH.js" as="script"><link rel="prefetch" href="/assets/index.html-DPlRMhSd.js" as="script"><link rel="prefetch" href="/assets/index.html-Cio44KwE.js" as="script"><link rel="prefetch" href="/assets/index.html-DGFOIAHP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bt3TVr5n.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh51Qxaz.js" as="script"><link rel="prefetch" href="/assets/index.html-DIo0REHR.js" as="script"><link rel="prefetch" href="/assets/index.html-BGOuIIaH.js" as="script"><link rel="prefetch" href="/assets/index.html-CvzRatBz.js" as="script"><link rel="prefetch" href="/assets/index.html-B1N3-3G-.js" as="script"><link rel="prefetch" href="/assets/index.html-eCwioAmF.js" as="script"><link rel="prefetch" href="/assets/index.html-DWA6yeSB.js" as="script"><link rel="prefetch" href="/assets/index.html-xhNc640L.js" as="script"><link rel="prefetch" href="/assets/index.html-CIHxDeDw.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy4Tx_MQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Bm3mN59n.js" as="script"><link rel="prefetch" href="/assets/index.html-HJl1kZ19.js" as="script"><link rel="prefetch" href="/assets/index.html-Da6klJA0.js" as="script"><link rel="prefetch" href="/assets/index.html-CiQ1dp1e.js" as="script"><link rel="prefetch" href="/assets/index.html-B64VFod1.js" as="script"><link rel="prefetch" href="/assets/index.html-4lnoYxya.js" as="script"><link rel="prefetch" href="/assets/index.html-BSGR6S2y.js" as="script"><link rel="prefetch" href="/assets/index.html-exKzpEXm.js" as="script"><link rel="prefetch" href="/assets/index.html-DSLVOwsR.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-DS8I962h.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/head1.jpeg" alt><!----><span class="vp-site-name hide-in-pad">Invoker</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ä¸»é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Javaå¼€å‘"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>Javaå¼€å‘</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link active" href="/java/" aria-label="Javaæ ¸å¿ƒ"><span class="font-icon icon iconfont icon-code" style=""></span>Javaæ ¸å¿ƒ<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/corejava/frameworks/" aria-label="æ¡†æ¶å®æˆ˜"><span class="font-icon icon iconfont icon-code" style=""></span>æ¡†æ¶å®æˆ˜<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/corejava/architecture/" aria-label="æ¶æ„è®¾è®¡"><span class="font-icon icon iconfont icon-code" style=""></span>æ¶æ„è®¾è®¡<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/corejava/tools/" aria-label="å¼€å‘å·¥å…·"><span class="font-icon icon iconfont icon-code" style=""></span>å¼€å‘å·¥å…·<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ä¸­é—´ä»¶"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/middleware/mq/" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><span class="font-icon icon iconfont icon-code" style=""></span>æ¶ˆæ¯é˜Ÿåˆ—<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/middleware/rpc/" aria-label="RPCæ¡†æ¶"><span class="font-icon icon iconfont icon-code" style=""></span>RPCæ¡†æ¶<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/middleware/discovery/" aria-label="æœåŠ¡æ²»ç†"><span class="font-icon icon iconfont icon-code" style=""></span>æœåŠ¡æ²»ç†<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/middleware/caching/" aria-label="ç¼“å­˜æŠ€æœ¯"><span class="font-icon icon iconfont icon-code" style=""></span>ç¼“å­˜æŠ€æœ¯<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/middleware/gateway/" aria-label="APIç½‘å…³"><span class="font-icon icon iconfont icon-code" style=""></span>APIç½‘å…³<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å¤§æ•°æ®"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>å¤§æ•°æ®</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/bigdata/hadoop/" aria-label="Hadoopç”Ÿæ€"><span class="font-icon icon iconfont icon-code" style=""></span>Hadoopç”Ÿæ€<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/bigdata/realtime_compute/" aria-label="å®æ—¶è®¡ç®—"><span class="font-icon icon iconfont icon-code" style=""></span>å®æ—¶è®¡ç®—<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/bigdata/data_storage/" aria-label="æ•°æ®å­˜å‚¨"><span class="font-icon icon iconfont icon-code" style=""></span>æ•°æ®å­˜å‚¨<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/database/rdbms/" aria-label="å…³ç³»å‹æ•°æ®åº“"><span class="font-icon icon iconfont icon-code" style=""></span>å…³ç³»å‹æ•°æ®åº“<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/database/nosql/" aria-label="éå…³ç³»å‹æ•°æ®åº“"><span class="font-icon icon iconfont icon-code" style=""></span>éå…³ç³»å‹æ•°æ®åº“<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="è¿ç»´æŠ€æœ¯"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>è¿ç»´æŠ€æœ¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/devops/basics/" aria-label="LinuxåŸºç¡€"><span class="font-icon icon iconfont icon-code" style=""></span>LinuxåŸºç¡€<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/devops/containerization/" aria-label="å®¹å™¨æŠ€æœ¯"><span class="font-icon icon iconfont icon-code" style=""></span>å®¹å™¨æŠ€æœ¯<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/devops/cicd/" aria-label="è‡ªåŠ¨åŒ–éƒ¨ç½²"><span class="font-icon icon iconfont icon-code" style=""></span>è‡ªåŠ¨åŒ–éƒ¨ç½²<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/devops/monitor/" aria-label="ç³»ç»Ÿç›‘æ§"><span class="font-icon icon iconfont icon-code" style=""></span>ç³»ç»Ÿç›‘æ§<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="è®¡ç®—æœºåŸºç¡€"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>è®¡ç®—æœºåŸºç¡€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/fundamentals/datastructures/" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><span class="font-icon icon iconfont icon-play" style=""></span>æ•°æ®ç»“æ„ä¸ç®—æ³•<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/fundamentals/computer_network/" aria-label="è®¡ç®—æœºç½‘ç»œ"><span class="font-icon icon iconfont icon-play" style=""></span>è®¡ç®—æœºç½‘ç»œ<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/fundamentals/operating_systems/" aria-label="æ“ä½œç³»ç»Ÿ"><span class="font-icon icon iconfont icon-play" style=""></span>æ“ä½œç³»ç»Ÿ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="äººå·¥æ™ºèƒ½"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>äººå·¥æ™ºèƒ½</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ•°å­¦åŸºç¡€</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/basic/1.html" aria-label="çº¿æ€§ä»£æ•°"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>çº¿æ€§ä»£æ•°<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/basic/2.html" aria-label="å¾®ç§¯åˆ†"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>å¾®ç§¯åˆ†<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/basic/2.html" aria-label="æ¦‚ç‡è®ºä¸ç»Ÿè®¡"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æ¦‚ç‡è®ºä¸ç»Ÿè®¡<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç¼–ç¨‹åŸºç¡€</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/1.html" aria-label="Python"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>Python<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="Pythonç§‘å­¦è®¡ç®—åº“"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>Pythonç§‘å­¦è®¡ç®—åº“<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æœºå™¨å­¦ä¹ åŸºç¡€</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/1.html" aria-label="å­¦ä¹ ã€Šæœºå™¨å­¦ä¹ ã€‹"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>å­¦ä¹ ã€Šæœºå™¨å­¦ä¹ ã€‹<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="ç†è§£ç›‘ç£å­¦ä¹ "><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç†è§£ç›‘ç£å­¦ä¹ <!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="æŒæ¡å†³ç­–æ ‘"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æŒæ¡å†³ç­–æ ‘<!----></a></li></ul></li><li class="dropdown-item"><a class="route-link nav-link" href="/ai/dragonfruit.html" aria-label="é¡¹ç›®å®è·µ"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>é¡¹ç›®å®è·µ<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ·±åº¦å­¦ä¹ åŸºç¡€</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/1.html" aria-label="å­¦ä¹ ã€Šæ·±åº¦å­¦ä¹ ã€‹"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>å­¦ä¹ ã€Šæ·±åº¦å­¦ä¹ ã€‹<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="ç†è§£ç¥ç»ç½‘ç»œ"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç†è§£ç¥ç»ç½‘ç»œ<!----></a></li></ul></li><li class="dropdown-item"><a class="route-link nav-link" href="/ai/dragonfruit.html" aria-label="æ·±åº¦å­¦ä¹ æ¡†æ¶"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æ·±åº¦å­¦ä¹ æ¡†æ¶<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/ai/dragonfruit.html" aria-label="é¡¹ç›®å®è·µ"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>é¡¹ç›®å®è·µ<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é«˜çº§ä¸»é¢˜</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/1.html" aria-label="è‡ªç„¶è¯­è¨€å¤„ç†"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>è‡ªç„¶è¯­è¨€å¤„ç†<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="è®¡ç®—æœºè§†è§‰"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>è®¡ç®—æœºè§†è§‰<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/ai/banana/2.html" aria-label="å¼ºåŒ–å­¦ä¹ "><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>å¼ºåŒ–å­¦ä¹ <!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/techtalks/" aria-label="æŠ€æœ¯æ‚è°ˆ"><span class="font-icon icon iconfont icon-note" style=""></span>æŠ€æœ¯æ‚è°ˆ<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="é€‰æ‹©è¯­è¨€"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link active" href="/java/concurrent/java-concurrent-questions-02.html" aria-label="ç®€ä½“ä¸­æ–‡"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/en/" aria-label="English"><!---->English<!----></a></li></ul></button></div></div><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/ByteInvoker" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:none;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:block;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon iconfont icon-basic" style=""></span><span class="vp-sidebar-title">åŸºç¡€</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/basis/java-basic-questions-01.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)"><!---->JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/basis/java-basic-questions-02.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸­)"><!---->JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸­)<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/basis/java-basic-questions-03.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)"><!---->JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-star" style=""></span><span class="vp-sidebar-title">é‡è¦çŸ¥è¯†ç‚¹</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon iconfont icon-container" style=""></span><span class="vp-sidebar-title">é›†åˆ</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/collection/java-collection-questions-01.html" aria-label="Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)"><!---->Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/collection/java-collection-questions-02.html" aria-label="Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)"><!---->Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/collection/java-collection-precautions-for-use.html" aria-label="Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"><!---->Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-star" style=""></span><span class="vp-sidebar-title">æºç åˆ†æ</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon iconfont icon-et-performance" style=""></span><span class="vp-sidebar-title">å¹¶å‘ç¼–ç¨‹</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/concurrent/java-concurrent-questions-01.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰"><!---->Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/java/concurrent/java-concurrent-questions-02.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰"><!---->Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/concurrent/java-concurrent-questions-03.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰"><!---->Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-star" style=""></span><span class="vp-sidebar-title">é‡è¦çŸ¥è¯†ç‚¹</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-code" style=""></span><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-virtual_machine" style=""></span><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-featured" style=""></span><span class="vp-sidebar-title">æ–°ç‰¹æ€§</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://ByteInvoker.github.io" target="_blank" rel="noopener noreferrer">Invoker</a></span><span property="author" content="Invoker"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-03-22T10:07:34.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category4 clickable" role="navigation">Java</span><!--]--><meta property="articleSection" content="Java"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag8 clickable" role="navigation">Javaå¹¶å‘</span><!--]--><meta property="keywords" content="Javaå¹¶å‘"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 31 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT31M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#jmm-java-å†…å­˜æ¨¡å‹">JMM(Java å†…å­˜æ¨¡å‹)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#volatile-å…³é”®å­—">volatile å…³é”®å­—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§">å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åº">å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#volatile-å¯ä»¥ä¿è¯åŸå­æ€§ä¹ˆ">volatile å¯ä»¥ä¿è¯åŸå­æ€§ä¹ˆï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#ä¹è§‚é”å’Œæ‚²è§‚é”">ä¹è§‚é”å’Œæ‚²è§‚é”</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#ä»€ä¹ˆæ˜¯æ‚²è§‚é”">ä»€ä¹ˆæ˜¯æ‚²è§‚é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#ä»€ä¹ˆæ˜¯ä¹è§‚é”">ä»€ä¹ˆæ˜¯ä¹è§‚é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¦‚ä½•å®ç°ä¹è§‚é”">å¦‚ä½•å®ç°ä¹è§‚é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#cas-ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜">CAS ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#synchronized-å…³é”®å­—">synchronized å…³é”®å­—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#synchronized-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç”¨">synchronized æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¦‚ä½•ä½¿ç”¨-synchronized">å¦‚ä½•ä½¿ç”¨ synchronizedï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ„é€ æ–¹æ³•å¯ä»¥ç”¨-synchronized-ä¿®é¥°ä¹ˆ">æ„é€ æ–¹æ³•å¯ä»¥ç”¨ synchronized ä¿®é¥°ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#synchronized-åº•å±‚åŸç†äº†è§£å—">synchronized åº•å±‚åŸç†äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#jdk1-6-ä¹‹åçš„-synchronized-åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–-é”å‡çº§åŸç†äº†è§£å—">JDK1.6 ä¹‹åçš„ synchronized åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿé”å‡çº§åŸç†äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#synchronized-å’Œ-volatile-æœ‰ä»€ä¹ˆåŒºåˆ«">synchronized å’Œ volatile æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#reentrantlock">ReentrantLock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#reentrantlock-æ˜¯ä»€ä¹ˆ">ReentrantLock æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰ä»€ä¹ˆåŒºåˆ«">å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆåŒºåˆ«">synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”æœ‰ä»€ä¹ˆåŒºåˆ«">å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#reentrantreadwritelock">ReentrantReadWriteLock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#reentrantreadwritelock-æ˜¯ä»€ä¹ˆ">ReentrantReadWriteLock æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#reentrantreadwritelock-é€‚åˆä»€ä¹ˆåœºæ™¯">ReentrantReadWriteLock é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å…±äº«é”å’Œç‹¬å é”æœ‰ä»€ä¹ˆåŒºåˆ«">å…±äº«é”å’Œç‹¬å é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#çº¿ç¨‹æŒæœ‰è¯»é”è¿˜èƒ½è·å–å†™é”å—">çº¿ç¨‹æŒæœ‰è¯»é”è¿˜èƒ½è·å–å†™é”å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”">è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#stampedlock">StampedLock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#stampedlock-æ˜¯ä»€ä¹ˆ">StampedLock æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#stampedlock-çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ›´å¥½">StampedLock çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ›´å¥½ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#stampedlock-é€‚åˆä»€ä¹ˆåœºæ™¯">StampedLock é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#stampedlock-çš„åº•å±‚åŸç†äº†è§£å—">StampedLock çš„åº•å±‚åŸç†äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#atomic-åŸå­ç±»">Atomic åŸå­ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#å‚è€ƒ">å‚è€ƒ</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="jmm-java-å†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#jmm-java-å†…å­˜æ¨¡å‹"><span>JMM(Java å†…å­˜æ¨¡å‹)</span></a></h2><p>JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œäºæ˜¯æˆ‘å•ç‹¬æŠ½äº†ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ JMM ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œé—®é¢˜ï¼š<a class="route-link" href="/java/concurrent/jmm.html">JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰è¯¦è§£</a> ã€‚</p><h2 id="volatile-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#volatile-å…³é”®å­—"><span>volatile å…³é”®å­—</span></a></h2><h3 id="å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§"><span>å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Ÿ</span></a></h3><p>åœ¨ Java ä¸­ï¼Œ<code>volatile</code> å…³é”®å­—å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œå¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º <strong><code>volatile</code></strong> ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm.png" alt="JMM(Java å†…å­˜æ¨¡å‹)" tabindex="0" loading="lazy"><figcaption>JMM(Java å†…å­˜æ¨¡å‹)</figcaption></figure><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm2.png" alt="JMM(Java å†…å­˜æ¨¡å‹)å¼ºåˆ¶åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å–" tabindex="0" loading="lazy"><figcaption>JMM(Java å†…å­˜æ¨¡å‹)å¼ºåˆ¶åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å–</figcaption></figure><p><code>volatile</code> å…³é”®å­—å…¶å®å¹¶éæ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„ï¼Œåœ¨ C è¯­è¨€é‡Œä¹Ÿæœ‰ï¼Œå®ƒæœ€åŸå§‹çš„æ„ä¹‰å°±æ˜¯ç¦ç”¨ CPU ç¼“å­˜ã€‚å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªå˜é‡ä½¿ç”¨ <code>volatile</code> ä¿®é¥°ï¼Œè¿™å°±æŒ‡ç¤º ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚</p><p><code>volatile</code> å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚<code>synchronized</code> å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</p><h3 id="å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åº" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åº"><span>å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Ÿ</span></a></h3><p><strong>åœ¨ Java ä¸­ï¼Œ<code>volatile</code> å…³é”®å­—é™¤äº†å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨å°±æ˜¯é˜²æ­¢ JVM çš„æŒ‡ä»¤é‡æ’åºã€‚</strong> å¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º <strong><code>volatile</code></strong> ï¼Œåœ¨å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ’å…¥ç‰¹å®šçš„ <strong>å†…å­˜å±éšœ</strong> çš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</p><p>åœ¨ Java ä¸­ï¼Œ<code>Unsafe</code> ç±»æä¾›äº†ä¸‰ä¸ªå¼€ç®±å³ç”¨çš„å†…å­˜å±éšœç›¸å…³çš„æ–¹æ³•ï¼Œå±è”½äº†æ“ä½œç³»ç»Ÿåº•å±‚çš„å·®å¼‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">loadFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">storeFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">fullFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç†è®ºä¸Šæ¥è¯´ï¼Œä½ é€šè¿‡è¿™ä¸ªä¸‰ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥å®ç°å’Œ<code>volatile</code>ç¦æ­¢é‡æ’åºä¸€æ ·çš„æ•ˆæœï¼Œåªæ˜¯ä¼šéº»çƒ¦ä¸€äº›ã€‚</p><p>ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ <code>volatile</code> å…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„æ•ˆæœã€‚</p><p>é¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€</p><p><strong>åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</strong>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> uniqueInstance<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getUniqueInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç±»å¯¹è±¡åŠ é”</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    uniqueInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> uniqueInstance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>uniqueInstance</code> é‡‡ç”¨ <code>volatile</code> å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ <code>uniqueInstance = new Singleton();</code> è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š</p><ol><li>ä¸º <code>uniqueInstance</code> åˆ†é…å†…å­˜ç©ºé—´</li><li>åˆå§‹åŒ– <code>uniqueInstance</code></li><li>å°† <code>uniqueInstance</code> æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€</li></ol><p>ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-&gt;3-&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ <code>getUniqueInstance</code>() åå‘ç° <code>uniqueInstance</code> ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› <code>uniqueInstance</code>ï¼Œä½†æ­¤æ—¶ <code>uniqueInstance</code> è¿˜æœªè¢«åˆå§‹åŒ–ã€‚</p><h3 id="volatile-å¯ä»¥ä¿è¯åŸå­æ€§ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#volatile-å¯ä»¥ä¿è¯åŸå­æ€§ä¹ˆ"><span>volatile å¯ä»¥ä¿è¯åŸå­æ€§ä¹ˆï¼Ÿ</span></a></h3><p><strong><code>volatile</code> å…³é”®å­—èƒ½ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯å¯¹å˜é‡çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</strong></p><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç å³å¯è¯æ˜ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¾®ä¿¡æœ JavaGuide å›å¤&quot;é¢è¯•çªå‡»&quot;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ
 *
 * <span class="token keyword">@author</span> Guideå“¥
 * <span class="token keyword">@date</span> 2022/08/03 13:40
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileAtomicityDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">int</span> inc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inc<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">VolatileAtomicityDemo</span> volatileAtomicityDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VolatileAtomicityDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    volatileAtomicityDemo<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ç­‰å¾…1.5ç§’ï¼Œä¿è¯ä¸Šé¢ç¨‹åºæ‰§è¡Œå®Œæˆ</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>inc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿è¡Œä¸Šé¢çš„ä»£ç ç†åº”è¾“å‡º <code>2500</code>ã€‚ä½†ä½ çœŸæ­£è¿è¡Œäº†ä¸Šé¢çš„ä»£ç ä¹‹åï¼Œä½ ä¼šå‘ç°æ¯æ¬¡è¾“å‡ºç»“æœéƒ½å°äº <code>2500</code>ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿä¸æ˜¯è¯´å¥½äº†ï¼Œ<code>volatile</code> å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§å˜›ï¼</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ <code>volatile</code> èƒ½ä¿è¯ <code>inc++</code> æ“ä½œçš„åŸå­æ€§çš„è¯ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹ <code>inc</code> å˜é‡è‡ªå¢å®Œä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³çœ‹åˆ°ä¿®æ”¹åçš„å€¼ã€‚5 ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº† 500 æ¬¡æ“ä½œï¼Œé‚£ä¹ˆæœ€ç»ˆ inc çš„å€¼åº”è¯¥æ˜¯ 5*500=2500ã€‚</p><p>å¾ˆå¤šäººä¼šè¯¯è®¤ä¸ºè‡ªå¢æ“ä½œ <code>inc++</code> æ˜¯åŸå­æ€§çš„ï¼Œå®é™…ä¸Šï¼Œ<code>inc++</code> å…¶å®æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼ŒåŒ…æ‹¬ä¸‰æ­¥ï¼š</p><ol><li>è¯»å– inc çš„å€¼ã€‚</li><li>å¯¹ inc åŠ  1ã€‚</li><li>å°† inc çš„å€¼å†™å›å†…å­˜ã€‚</li></ol><p><code>volatile</code> æ˜¯æ— æ³•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œæ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œæœ‰å¯èƒ½å¯¼è‡´ä¸‹é¢è¿™ç§æƒ…å†µå‡ºç°ï¼š</p><ol><li>çº¿ç¨‹ 1 å¯¹ <code>inc</code> è¿›è¡Œè¯»å–æ“ä½œä¹‹åï¼Œè¿˜æœªå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚çº¿ç¨‹ 2 åˆè¯»å–äº† <code>inc</code>çš„å€¼å¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼ˆ+1ï¼‰ï¼Œå†å°†<code>inc</code> çš„å€¼å†™å›å†…å­˜ã€‚</li><li>çº¿ç¨‹ 2 æ“ä½œå®Œæ¯•åï¼Œçº¿ç¨‹ 1 å¯¹ <code>inc</code>çš„å€¼è¿›è¡Œä¿®æ”¹ï¼ˆ+1ï¼‰ï¼Œå†å°†<code>inc</code> çš„å€¼å†™å›å†…å­˜ã€‚</li></ol><p>è¿™ä¹Ÿå°±å¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹ <code>inc</code> è¿›è¡Œäº†ä¸€æ¬¡è‡ªå¢æ“ä½œåï¼Œ<code>inc</code> å®é™…ä¸Šåªå¢åŠ äº† 1ã€‚</p><p>å…¶å®ï¼Œå¦‚æœæƒ³è¦ä¿è¯ä¸Šé¢çš„ä»£ç è¿è¡Œæ­£ç¡®ä¹Ÿéå¸¸ç®€å•ï¼Œåˆ©ç”¨ <code>synchronized</code>ã€<code>Lock</code>æˆ–è€…<code>AtomicInteger</code>éƒ½å¯ä»¥ã€‚</p><p>ä½¿ç”¨ <code>synchronized</code> æ”¹è¿›ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inc<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>AtomicInteger</code> æ”¹è¿›ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">AtomicInteger</span> inc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inc<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>ReentrantLock</code> æ”¹è¿›ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        inc<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¹è§‚é”å’Œæ‚²è§‚é”" tabindex="-1"><a class="header-anchor" href="#ä¹è§‚é”å’Œæ‚²è§‚é”"><span>ä¹è§‚é”å’Œæ‚²è§‚é”</span></a></h2><h3 id="ä»€ä¹ˆæ˜¯æ‚²è§‚é”" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ‚²è§‚é”"><span>ä»€ä¹ˆæ˜¯æ‚²è§‚é”ï¼Ÿ</span></a></h3><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜(æ¯”å¦‚å…±äº«æ•°æ®è¢«ä¿®æ”¹)ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ã€‚</p><p>åƒ Java ä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performSynchronisedTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// éœ€è¦åŒæ­¥çš„æ“ä½œ</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token comment">// éœ€è¦åŒæ­¥çš„æ“ä½œ</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ¿€çƒˆçš„é”ç«äº‰ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œå¤§é‡é˜»å¡çº¿ç¨‹ä¼šå¯¼è‡´ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ã€‚å¹¶ä¸”ï¼Œæ‚²è§‚é”è¿˜å¯èƒ½ä¼šå­˜åœ¨æ­»é”é—®é¢˜ï¼Œå½±å“ä»£ç çš„æ­£å¸¸è¿è¡Œã€‚</p><h3 id="ä»€ä¹ˆæ˜¯ä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ä¹è§‚é”"><span>ä»€ä¹ˆæ˜¯ä¹è§‚é”ï¼Ÿ</span></a></h3><p>ä¹è§‚é”æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œçº¿ç¨‹å¯ä»¥ä¸åœåœ°æ‰§è¡Œï¼Œæ— éœ€åŠ é”ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œåªæ˜¯åœ¨æäº¤ä¿®æ”¹çš„æ—¶å€™å»éªŒè¯å¯¹åº”çš„èµ„æºï¼ˆä¹Ÿå°±æ˜¯æ•°æ®ï¼‰æ˜¯å¦è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹äº†ï¼ˆå…·ä½“æ–¹æ³•å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ– CAS ç®—æ³•ï¼‰ã€‚</p><p>åœ¨ Java ä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»ï¼ˆæ¯”å¦‚<code>AtomicInteger</code>ã€<code>LongAdder</code>ï¼‰å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ <strong>CAS</strong> å®ç°çš„ã€‚ <img src="https://oss.javaguide.cn/github/javaguide/java/JUCåŸå­ç±»æ¦‚è§ˆ-20230814005211968.png" alt="JUCåŸå­ç±»æ¦‚è§ˆ" loading="lazy"></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// LongAdder åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šæ¯” AtomicInteger å’Œ AtomicLong çš„æ€§èƒ½æ›´å¥½</span>
<span class="token comment">// ä»£ä»·å°±æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰</span>
<span class="token class-name">LongAdder</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sum<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œä¹è§‚é”ç›¸æ¯”æ‚²è§‚é”æ¥è¯´ï¼Œä¸å­˜åœ¨é”ç«äº‰é€ æˆçº¿ç¨‹é˜»å¡ï¼Œä¹Ÿä¸ä¼šæœ‰æ­»é”çš„é—®é¢˜ï¼Œåœ¨æ€§èƒ½ä¸Šå¾€å¾€ä¼šæ›´èƒœä¸€ç­¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå†²çªé¢‘ç¹å‘ç”Ÿï¼ˆå†™å æ¯”éå¸¸å¤šçš„æƒ…å†µï¼‰ï¼Œä¼šé¢‘ç¹å¤±è´¥å’Œé‡è¯•ï¼Œè¿™æ ·åŒæ ·ä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œå¯¼è‡´ CPU é£™å‡ã€‚</p><p>ä¸è¿‡ï¼Œå¤§é‡å¤±è´¥é‡è¯•çš„é—®é¢˜ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ï¼Œåƒæˆ‘ä»¬å‰é¢æåˆ°çš„ <code>LongAdder</code>ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç†è®ºä¸Šæ¥è¯´ï¼š</p><ul><li>æ‚²è§‚é”é€šå¸¸å¤šç”¨äºå†™æ¯”è¾ƒå¤šçš„æƒ…å†µï¼ˆå¤šå†™åœºæ™¯ï¼Œç«äº‰æ¿€çƒˆï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹å¤±è´¥å’Œé‡è¯•å½±å“æ€§èƒ½ï¼Œæ‚²è§‚é”çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚ä¸è¿‡ï¼Œå¦‚æœä¹è§‚é”è§£å†³äº†é¢‘ç¹å¤±è´¥å’Œé‡è¯•è¿™ä¸ªé—®é¢˜çš„è¯ï¼ˆæ¯”å¦‚<code>LongAdder</code>ï¼‰ï¼Œä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¹è§‚é”çš„ï¼Œè¦è§†å®é™…æƒ…å†µè€Œå®šã€‚</li><li>ä¹è§‚é”é€šå¸¸å¤šç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼ˆå¤šè¯»åœºæ™¯ï¼Œç«äº‰è¾ƒå°‘ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹åŠ é”å½±å“æ€§èƒ½ã€‚ä¸è¿‡ï¼Œä¹è§‚é”ä¸»è¦é’ˆå¯¹çš„å¯¹è±¡æ˜¯å•ä¸ªå…±äº«å˜é‡ï¼ˆå‚è€ƒ<code>java.util.concurrent.atomic</code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»ï¼‰ã€‚</li></ul><h3 id="å¦‚ä½•å®ç°ä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å®ç°ä¹è§‚é”"><span>å¦‚ä½•å®ç°ä¹è§‚é”ï¼Ÿ</span></a></h3><p>ä¹è§‚é”ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ– CAS ç®—æ³•å®ç°ï¼ŒCAS ç®—æ³•ç›¸å¯¹æ¥è¯´æ›´å¤šä¸€äº›ï¼Œè¿™é‡Œéœ€è¦æ ¼å¤–æ³¨æ„ã€‚</p><h4 id="ç‰ˆæœ¬å·æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬å·æœºåˆ¶"><span>ç‰ˆæœ¬å·æœºåˆ¶</span></a></h4><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å· <code>version</code> å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œ<code>version</code> å€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹ A è¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å– <code>version</code> å€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„ version å€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„ <code>version</code> å€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><p><strong>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</strong>ï¼šå‡è®¾æ•°æ®åº“ä¸­å¸æˆ·ä¿¡æ¯è¡¨ä¸­æœ‰ä¸€ä¸ª version å­—æ®µï¼Œå½“å‰å€¼ä¸º 1 ï¼›è€Œå½“å‰å¸æˆ·ä½™é¢å­—æ®µï¼ˆ <code>balance</code> ï¼‰ä¸º $100 ã€‚</p><ol><li>æ“ä½œå‘˜ A æ­¤æ—¶å°†å…¶è¯»å‡ºï¼ˆ <code>version</code>=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $50ï¼ˆ $100-$50 ï¼‰ã€‚</li><li>åœ¨æ“ä½œå‘˜ A æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå‘˜ B ä¹Ÿè¯»å…¥æ­¤ç”¨æˆ·ä¿¡æ¯ï¼ˆ <code>version</code>=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $20 ï¼ˆ $100-$20 ï¼‰ã€‚</li><li>æ“ä½œå‘˜ A å®Œæˆäº†ä¿®æ”¹å·¥ä½œï¼Œå°†æ•°æ®ç‰ˆæœ¬å·ï¼ˆ <code>version</code>=1 ï¼‰ï¼Œè¿åŒå¸æˆ·æ‰£é™¤åä½™é¢ï¼ˆ <code>balance</code>=$50 ï¼‰ï¼Œæäº¤è‡³æ•°æ®åº“æ›´æ–°ï¼Œæ­¤æ—¶ç”±äºæäº¤æ•°æ®ç‰ˆæœ¬ç­‰äºæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ï¼Œæ•°æ®è¢«æ›´æ–°ï¼Œæ•°æ®åº“è®°å½• <code>version</code> æ›´æ–°ä¸º 2 ã€‚</li><li>æ“ä½œå‘˜ B å®Œæˆäº†æ“ä½œï¼Œä¹Ÿå°†ç‰ˆæœ¬å·ï¼ˆ <code>version</code>=1 ï¼‰è¯•å›¾å‘æ•°æ®åº“æäº¤æ•°æ®ï¼ˆ <code>balance</code>=$80 ï¼‰ï¼Œä½†æ­¤æ—¶æ¯”å¯¹æ•°æ®åº“è®°å½•ç‰ˆæœ¬æ—¶å‘ç°ï¼Œæ“ä½œå‘˜ B æäº¤çš„æ•°æ®ç‰ˆæœ¬å·ä¸º 1 ï¼Œæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ä¹Ÿä¸º 2 ï¼Œä¸æ»¡è¶³ â€œ æäº¤ç‰ˆæœ¬å¿…é¡»ç­‰äºå½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–° â€œ çš„ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ“ä½œå‘˜ B çš„æäº¤è¢«é©³å›ã€‚</li></ol><p>è¿™æ ·å°±é¿å…äº†æ“ä½œå‘˜ B ç”¨åŸºäº <code>version</code>=1 çš„æ—§æ•°æ®ä¿®æ”¹çš„ç»“æœè¦†ç›–æ“ä½œå‘˜ A çš„æ“ä½œç»“æœçš„å¯èƒ½ã€‚</p><h4 id="cas-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#cas-ç®—æ³•"><span>CAS ç®—æ³•</span></a></h4><p>CAS çš„å…¨ç§°æ˜¯ <strong>Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰</strong> ï¼Œç”¨äºå®ç°ä¹è§‚é”ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå„å¤§æ¡†æ¶ä¸­ã€‚CAS çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªé¢„æœŸå€¼å’Œè¦æ›´æ–°çš„å˜é‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸¤å€¼ç›¸ç­‰æ‰ä¼šè¿›è¡Œæ›´æ–°ã€‚</p><p>CAS æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œåº•å±‚ä¾èµ–äºä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ã€‚</p><blockquote><p><strong>åŸå­æ“ä½œ</strong> å³æœ€å°ä¸å¯æ‹†åˆ†çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸èƒ½è¢«æ‰“æ–­ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚</p></blockquote><p>CAS æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><ul><li><strong>V</strong>ï¼šè¦æ›´æ–°çš„å˜é‡å€¼(Var)</li><li><strong>E</strong>ï¼šé¢„æœŸå€¼(Expected)</li><li><strong>N</strong>ï¼šæ‹Ÿå†™å…¥çš„æ–°å€¼(New)</li></ul><p>å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº E æ—¶ï¼ŒCAS é€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼ N æ¥æ›´æ–° V çš„å€¼ã€‚å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº† Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ã€‚</p><p><strong>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</strong>ï¼šçº¿ç¨‹ A è¦ä¿®æ”¹å˜é‡ i çš„å€¼ä¸º 6ï¼Œi åŸå€¼ä¸º 1ï¼ˆV = 1ï¼ŒE=1ï¼ŒN=6ï¼Œå‡è®¾ä¸å­˜åœ¨ ABA é—®é¢˜ï¼‰ã€‚</p><ol><li>i ä¸ 1 è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œ åˆ™è¯´æ˜æ²¡è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå¯ä»¥è¢«è®¾ç½®ä¸º 6 ã€‚</li><li>i ä¸ 1 è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ï¼ŒCAS æ“ä½œå¤±è´¥ã€‚</li></ol><p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ CAS æ“ä½œä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºï¼Œå¹¶æˆåŠŸæ›´æ–°ï¼Œå…¶ä½™å‡ä¼šå¤±è´¥ï¼Œä½†å¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œä»…æ˜¯è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚</p><p>Java è¯­è¨€å¹¶æ²¡æœ‰ç›´æ¥å®ç° CASï¼ŒCAS ç›¸å…³çš„å®ç°æ˜¯é€šè¿‡ C++ å†…è”æ±‡ç¼–çš„å½¢å¼å®ç°çš„ï¼ˆJNI è°ƒç”¨ï¼‰ã€‚å› æ­¤ï¼Œ CAS çš„å…·ä½“å®ç°å’Œæ“ä½œç³»ç»Ÿä»¥åŠ CPU éƒ½æœ‰å…³ç³»ã€‚</p><p><code>sun.misc</code>åŒ…ä¸‹çš„<code>Unsafe</code>ç±»æä¾›äº†<code>compareAndSwapObject</code>ã€<code>compareAndSwapInt</code>ã€<code>compareAndSwapLong</code>æ–¹æ³•æ¥å®ç°çš„å¯¹<code>Object</code>ã€<code>int</code>ã€<code>long</code>ç±»å‹çš„ CAS æ“ä½œ</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  *  CAS
  * <span class="token keyword">@param</span> <span class="token parameter">o</span>         åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡
  * <span class="token keyword">@param</span> <span class="token parameter">offset</span>    å¯¹è±¡ä¸­æŸfieldçš„åç§»é‡
  * <span class="token keyword">@param</span> <span class="token parameter">expected</span>  æœŸæœ›å€¼
  * <span class="token keyword">@param</span> <span class="token parameter">update</span>    æ›´æ–°å€¼
  * <span class="token keyword">@return</span>          true | false
  */</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span>  <span class="token class-name">Object</span> expected<span class="token punctuation">,</span> <span class="token class-name">Object</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> expected<span class="token punctuation">,</span><span class="token keyword">int</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">long</span> expected<span class="token punctuation">,</span> <span class="token keyword">long</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äº <code>Unsafe</code> ç±»çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://javaguide.cn/java/basis/unsafe.html" target="_blank" rel="noopener noreferrer">Java é­”æ³•ç±» Unsafe è¯¦è§£ - JavaGuide - 2022<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ã€‚</p><h3 id="cas-ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#cas-ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜"><span>CAS ç®—æ³•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ</span></a></h3><p>ABA é—®é¢˜æ˜¯ CAS ç®—æ³•æœ€å¸¸è§çš„é—®é¢˜ã€‚</p><h4 id="aba-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#aba-é—®é¢˜"><span>ABA é—®é¢˜</span></a></h4><p>å¦‚æœä¸€ä¸ªå˜é‡ V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯ A å€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å› Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º CAS æ“ä½œçš„ <strong>&quot;ABA&quot;é—®é¢˜ã€‚</strong></p><p>ABA é—®é¢˜çš„è§£å†³æ€è·¯æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Š<strong>ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³</strong>ã€‚JDK 1.5 ä»¥åçš„ <code>AtomicStampedReference</code> ç±»å°±æ˜¯ç”¨æ¥è§£å†³ ABA é—®é¢˜çš„ï¼Œå…¶ä¸­çš„ <code>compareAndSet()</code> æ–¹æ³•å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token class-name">V</span>   expectedReference<span class="token punctuation">,</span>
                             <span class="token class-name">V</span>   newReference<span class="token punctuation">,</span>
                             <span class="token keyword">int</span> expectedStamp<span class="token punctuation">,</span>
                             <span class="token keyword">int</span> newStamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> current <span class="token operator">=</span> pair<span class="token punctuation">;</span>
    <span class="token keyword">return</span>
        expectedReference <span class="token operator">==</span> current<span class="token punctuation">.</span>reference <span class="token operator">&amp;&amp;</span>
        expectedStamp <span class="token operator">==</span> current<span class="token punctuation">.</span>stamp <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span>newReference <span class="token operator">==</span> current<span class="token punctuation">.</span>reference <span class="token operator">&amp;&amp;</span>
          newStamp <span class="token operator">==</span> current<span class="token punctuation">.</span>stamp<span class="token punctuation">)</span> <span class="token operator">||</span>
         <span class="token function">casPair</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>newReference<span class="token punctuation">,</span> newStamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§" tabindex="-1"><a class="header-anchor" href="#å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§"><span>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</span></a></h4><p>CAS ç»å¸¸ä¼šç”¨åˆ°è‡ªæ—‹æ“ä½œæ¥è¿›è¡Œé‡è¯•ï¼Œä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><p>å¦‚æœ JVM èƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„ pause æŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼Œpause æŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>å¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼Œä½¿ CPU ä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚</li><li>å¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªè€Œå¼•èµ· CPU æµæ°´çº¿è¢«æ¸…ç©ºï¼Œä»è€Œæé«˜ CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚</li></ol><h4 id="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ"><span>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</span></a></h4><p>CAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5 å¼€å§‹ï¼Œæä¾›äº†<code>AtomicReference</code>ç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨<code>AtomicReference</code>ç±»æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚</p><h2 id="synchronized-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#synchronized-å…³é”®å­—"><span>synchronized å…³é”®å­—</span></a></h2><h3 id="synchronized-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#synchronized-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç”¨"><span>synchronized æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></a></h3><p><code>synchronized</code> æ˜¯ Java ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯åŒæ­¥çš„æ„æ€ï¼Œä¸»è¦è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p>åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>synchronized</code> å±äº <strong>é‡é‡çº§é”</strong>ï¼Œæ•ˆç‡ä½ä¸‹ã€‚è¿™æ˜¯å› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ <code>Mutex Lock</code> æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨ Java 6 ä¹‹åï¼Œ <code>synchronized</code> å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–å¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ï¼Œè¿™äº›ä¼˜åŒ–è®© <code>synchronized</code> é”çš„æ•ˆç‡æå‡äº†å¾ˆå¤šã€‚å› æ­¤ï¼Œ <code>synchronized</code> è¿˜æ˜¯å¯ä»¥åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„ï¼Œåƒ JDK æºç ã€å¾ˆå¤šå¼€æºæ¡†æ¶éƒ½å¤§é‡ä½¿ç”¨äº† <code>synchronized</code> ã€‚</p><p>å…³äºåå‘é”å¤šè¡¥å……ä¸€ç‚¹ï¼šç”±äºåå‘é”å¢åŠ äº† JVM çš„å¤æ‚æ€§ï¼ŒåŒæ—¶ä¹Ÿå¹¶æ²¡æœ‰ä¸ºæ‰€æœ‰åº”ç”¨éƒ½å¸¦æ¥æ€§èƒ½æå‡ã€‚å› æ­¤ï¼Œåœ¨ JDK15 ä¸­ï¼Œåå‘é”è¢«é»˜è®¤å…³é—­ï¼ˆä»ç„¶å¯ä»¥ä½¿ç”¨ <code>-XX:+UseBiasedLocking</code> å¯ç”¨åå‘é”ï¼‰ï¼Œåœ¨ JDK18 ä¸­ï¼Œåå‘é”å·²ç»è¢«å½»åº•åºŸå¼ƒï¼ˆæ— æ³•é€šè¿‡å‘½ä»¤è¡Œæ‰“å¼€ï¼‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-synchronized" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-synchronized"><span>å¦‚ä½•ä½¿ç”¨ synchronizedï¼Ÿ</span></a></h3><p><code>synchronized</code> å…³é”®å­—çš„ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸‹é¢ 3 ç§ï¼š</p><ol><li>ä¿®é¥°å®ä¾‹æ–¹æ³•</li><li>ä¿®é¥°é™æ€æ–¹æ³•</li><li>ä¿®é¥°ä»£ç å—</li></ol><p><strong>1ã€ä¿®é¥°å®ä¾‹æ–¹æ³•</strong> ï¼ˆé”å½“å‰å¯¹è±¡å®ä¾‹ï¼‰</p><p>ç»™å½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— <strong>å½“å‰å¯¹è±¡å®ä¾‹çš„é”</strong> ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2ã€ä¿®é¥°é™æ€æ–¹æ³•</strong> ï¼ˆé”å½“å‰ç±»ï¼‰</p><p>ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— <strong>å½“å‰ class çš„é”</strong>ã€‚</p><p>è¿™æ˜¯å› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå½’æ•´ä¸ªç±»æ‰€æœ‰ï¼Œä¸ä¾èµ–äºç±»çš„ç‰¹å®šå®ä¾‹ï¼Œè¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™æ€ <code>synchronized</code> æ–¹æ³•å’Œéé™æ€ <code>synchronized</code> æ–¹æ³•ä¹‹é—´çš„è°ƒç”¨äº’æ–¥ä¹ˆï¼Ÿä¸äº’æ–¥ï¼å¦‚æœä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ <code>synchronized</code> æ–¹æ³•ï¼Œè€Œçº¿ç¨‹ B éœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ <code>synchronized</code> æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—®é™æ€ <code>synchronized</code> æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€ <code>synchronized</code> æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ã€‚</p><p><strong>3ã€ä¿®é¥°ä»£ç å—</strong> ï¼ˆé”æŒ‡å®šå¯¹è±¡/ç±»ï¼‰</p><p>å¯¹æ‹¬å·é‡ŒæŒ‡å®šçš„å¯¹è±¡/ç±»åŠ é”ï¼š</p><ul><li><code>synchronized(object)</code> è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾— <strong>ç»™å®šå¯¹è±¡çš„é”</strong>ã€‚</li><li><code>synchronized(ç±».class)</code> è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— <strong>ç»™å®š Class çš„é”</strong></li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€»ç»“ï¼š</strong></p><ul><li><code>synchronized</code> å…³é”®å­—åŠ åˆ° <code>static</code> é™æ€æ–¹æ³•å’Œ <code>synchronized(class)</code> ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ï¼›</li><li><code>synchronized</code> å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ï¼›</li><li>å°½é‡ä¸è¦ä½¿ç”¨ <code>synchronized(String a)</code> å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ã€‚</li></ul><h3 id="æ„é€ æ–¹æ³•å¯ä»¥ç”¨-synchronized-ä¿®é¥°ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æ„é€ æ–¹æ³•å¯ä»¥ç”¨-synchronized-ä¿®é¥°ä¹ˆ"><span>æ„é€ æ–¹æ³•å¯ä»¥ç”¨ synchronized ä¿®é¥°ä¹ˆï¼Ÿ</span></a></h3><p>å…ˆè¯´ç»“è®ºï¼š<strong>æ„é€ æ–¹æ³•ä¸èƒ½ä½¿ç”¨ synchronized å…³é”®å­—ä¿®é¥°ã€‚</strong></p><p>æ„é€ æ–¹æ³•æœ¬èº«å°±å±äºçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å­˜åœ¨åŒæ­¥çš„æ„é€ æ–¹æ³•ä¸€è¯´ã€‚</p><h3 id="synchronized-åº•å±‚åŸç†äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#synchronized-åº•å±‚åŸç†äº†è§£å—"><span>synchronized åº•å±‚åŸç†äº†è§£å—ï¼Ÿ</span></a></h3><p>synchronized å…³é”®å­—åº•å±‚åŸç†å±äº JVM å±‚é¢çš„ä¸œè¥¿ã€‚</p><h4 id="synchronized-åŒæ­¥è¯­å¥å—çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#synchronized-åŒæ­¥è¯­å¥å—çš„æƒ…å†µ"><span>synchronized åŒæ­¥è¯­å¥å—çš„æƒ…å†µ</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized ä»£ç å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ JDK è‡ªå¸¦çš„ <code>javap</code> å‘½ä»¤æŸ¥çœ‹ <code>SynchronizedDemo</code> ç±»çš„ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼šé¦–å…ˆåˆ‡æ¢åˆ°ç±»çš„å¯¹åº”ç›®å½•æ‰§è¡Œ <code>javac SynchronizedDemo.java</code> å‘½ä»¤ç”Ÿæˆç¼–è¯‘åçš„ .class æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ<code>javap -c -s -v -l SynchronizedDemo.class</code>ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-principle.png" alt="synchronizedå…³é”®å­—åŸç†" tabindex="0" loading="lazy"><figcaption>synchronizedå…³é”®å­—åŸç†</figcaption></figure><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š<strong><code>synchronized</code> åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ <code>monitorenter</code> å’Œ <code>monitorexit</code> æŒ‡ä»¤ï¼Œå…¶ä¸­ <code>monitorenter</code> æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ<code>monitorexit</code> æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚</strong></p><p>ä¸Šé¢çš„å­—èŠ‚ç ä¸­åŒ…å«ä¸€ä¸ª <code>monitorenter</code> æŒ‡ä»¤ä»¥åŠä¸¤ä¸ª <code>monitorexit</code> æŒ‡ä»¤ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯é”åœ¨åŒæ­¥ä»£ç å—ä»£ç æ­£å¸¸æ‰§è¡Œä»¥åŠå‡ºç°å¼‚å¸¸çš„è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½èƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚</p><p>å½“æ‰§è¡Œ <code>monitorenter</code> æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å– <strong>å¯¹è±¡ç›‘è§†å™¨ <code>monitor</code></strong> çš„æŒæœ‰æƒã€‚</p><blockquote><p>åœ¨ Java è™šæ‹Ÿæœº(HotSpot)ä¸­ï¼ŒMonitor æ˜¯åŸºäº C++å®ç°çš„ï¼Œç”±<a href="https://github.com/openjdk-mirror/jdk7u-hotspot/blob/50bdefc3afe944ca74c3093e7448d6b889cd20d1/src/share/vm/runtime/objectMonitor.cpp" target="_blank" rel="noopener noreferrer">ObjectMonitor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å®ç°çš„ã€‚æ¯ä¸ªå¯¹è±¡ä¸­éƒ½å†…ç½®äº†ä¸€ä¸ª <code>ObjectMonitor</code>å¯¹è±¡ã€‚</p><p>å¦å¤–ï¼Œ<code>wait/notify</code>ç­‰æ–¹æ³•ä¹Ÿä¾èµ–äº<code>monitor</code>å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰åœ¨åŒæ­¥çš„å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨<code>wait/notify</code>ç­‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>java.lang.IllegalMonitorStateException</code>çš„å¼‚å¸¸çš„åŸå› ã€‚</p></blockquote><p>åœ¨æ‰§è¡Œ<code>monitorenter</code>æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœé”çš„è®¡æ•°å™¨ä¸º 0 åˆ™è¡¨ç¤ºé”å¯ä»¥è¢«è·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º 1 ä¹Ÿå°±æ˜¯åŠ  1ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-get-lock-code-block.png" alt="æ‰§è¡Œ monitorenter è·å–é”" tabindex="0" loading="lazy"><figcaption>æ‰§è¡Œ monitorenter è·å–é”</figcaption></figure><p>å¯¹è±¡é”çš„çš„æ‹¥æœ‰è€…çº¿ç¨‹æ‰å¯ä»¥æ‰§è¡Œ <code>monitorexit</code> æŒ‡ä»¤æ¥é‡Šæ”¾é”ã€‚åœ¨æ‰§è¡Œ <code>monitorexit</code> æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º 0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å°è¯•è·å–é”ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/synchronized-release-lock-block.png" alt="æ‰§è¡Œ monitorexit é‡Šæ”¾é”" tabindex="0" loading="lazy"><figcaption>æ‰§è¡Œ monitorexit é‡Šæ”¾é”</figcaption></figure><p>å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚</p><h4 id="synchronized-ä¿®é¥°æ–¹æ³•çš„çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#synchronized-ä¿®é¥°æ–¹æ³•çš„çš„æƒ…å†µ"><span>synchronized ä¿®é¥°æ–¹æ³•çš„çš„æƒ…å†µ</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;synchronized æ–¹æ³•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://oss.javaguide.cn/github/javaguide/synchronizedå…³é”®å­—åŸç†2.png" alt="synchronizedå…³é”®å­—åŸç†" tabindex="0" loading="lazy"><figcaption>synchronizedå…³é”®å­—åŸç†</figcaption></figure><p><code>synchronized</code> ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ <code>monitorenter</code> æŒ‡ä»¤å’Œ <code>monitorexit</code> æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ <code>ACC_SYNCHRONIZED</code> æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚JVM é€šè¿‡è¯¥ <code>ACC_SYNCHRONIZED</code> è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚</p><p>å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å®ä¾‹å¯¹è±¡çš„é”ã€‚å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å½“å‰ class çš„é”ã€‚</p><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h4><p><code>synchronized</code> åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ <code>monitorenter</code> å’Œ <code>monitorexit</code> æŒ‡ä»¤ï¼Œå…¶ä¸­ <code>monitorenter</code> æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ<code>monitorexit</code> æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚</p><p><code>synchronized</code> ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ <code>monitorenter</code> æŒ‡ä»¤å’Œ <code>monitorexit</code> æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ <code>ACC_SYNCHRONIZED</code> æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚</p><p><strong>ä¸è¿‡ä¸¤è€…çš„æœ¬è´¨éƒ½æ˜¯å¯¹å¯¹è±¡ç›‘è§†å™¨ monitor çš„è·å–ã€‚</strong></p><p>ç›¸å…³æ¨èï¼š<a href="https://tech.youzan.com/javasuo-yu-xian-cheng-de-na-xie-shi/" target="_blank" rel="noopener noreferrer">Java é”ä¸çº¿ç¨‹çš„é‚£äº›äº‹ - æœ‰èµæŠ€æœ¯å›¢é˜Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ã€‚</p><p>ğŸ§—ğŸ» è¿›é˜¶ä¸€ä¸‹ï¼šå­¦æœ‰ä½™åŠ›çš„å°ä¼™ä¼´å¯ä»¥æŠ½æ—¶é—´è¯¦ç»†ç ”ç©¶ä¸€ä¸‹å¯¹è±¡ç›‘è§†å™¨ <code>monitor</code>ã€‚</p><h3 id="jdk1-6-ä¹‹åçš„-synchronized-åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–-é”å‡çº§åŸç†äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#jdk1-6-ä¹‹åçš„-synchronized-åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–-é”å‡çº§åŸç†äº†è§£å—"><span>JDK1.6 ä¹‹åçš„ synchronized åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿé”å‡çº§åŸç†äº†è§£å—ï¼Ÿ</span></a></h3><p>åœ¨ Java 6 ä¹‹åï¼Œ <code>synchronized</code> å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–å¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ï¼Œè¿™äº›ä¼˜åŒ–è®© <code>synchronized</code> é”çš„æ•ˆç‡æå‡äº†å¾ˆå¤šï¼ˆJDK18 ä¸­ï¼Œåå‘é”å·²ç»è¢«å½»åº•åºŸå¼ƒï¼Œå‰é¢å·²ç»æåˆ°è¿‡äº†ï¼‰ã€‚</p><p>é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«äº‰çš„æ¿€çƒˆè€Œé€æ¸å‡çº§ã€‚æ³¨æ„é”å¯ä»¥å‡çº§ä¸å¯é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</p><p><code>synchronized</code> é”å‡çº§æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œé¢è¯•ä¹Ÿå¾ˆå°‘é—®åˆ°ï¼Œå¦‚æœä½ æƒ³è¦è¯¦ç»†äº†è§£çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/star95/p/17542850.html" target="_blank" rel="noopener noreferrer">æµ…æ synchronized é”å‡çº§çš„åŸç†ä¸å®ç°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h3 id="synchronized-å’Œ-volatile-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#synchronized-å’Œ-volatile-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>synchronized å’Œ volatile æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p><code>synchronized</code> å…³é”®å­—å’Œ <code>volatile</code> å…³é”®å­—æ˜¯ä¸¤ä¸ªäº’è¡¥çš„å­˜åœ¨ï¼Œè€Œä¸æ˜¯å¯¹ç«‹çš„å­˜åœ¨ï¼</p><ul><li><code>volatile</code> å…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥ <code>volatile</code>æ€§èƒ½è‚¯å®šæ¯”<code>synchronized</code>å…³é”®å­—è¦å¥½ ã€‚ä½†æ˜¯ <code>volatile</code> å…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œ <code>synchronized</code> å…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å— ã€‚</li><li><code>volatile</code> å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚<code>synchronized</code> å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</li><li><code>volatile</code>å…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ <code>synchronized</code> å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚</li></ul><h2 id="reentrantlock" tabindex="-1"><a class="header-anchor" href="#reentrantlock"><span>ReentrantLock</span></a></h2><h3 id="reentrantlock-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#reentrantlock-æ˜¯ä»€ä¹ˆ"><span>ReentrantLock æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p><code>ReentrantLock</code> å®ç°äº† <code>Lock</code> æ¥å£ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼çš„é”ï¼Œå’Œ <code>synchronized</code> å…³é”®å­—ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œ<code>ReentrantLock</code> æ›´çµæ´»ã€æ›´å¼ºå¤§ï¼Œå¢åŠ äº†è½®è¯¢ã€è¶…æ—¶ã€ä¸­æ–­ã€å…¬å¹³é”å’Œéå…¬å¹³é”ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>ReentrantLock</code> é‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±» <code>Sync</code>ï¼Œ<code>Sync</code> ç»§æ‰¿ AQSï¼ˆ<code>AbstractQueuedSynchronizer</code>ï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨ <code>Sync</code> ä¸­å®ç°çš„ã€‚<code>Sync</code> æœ‰å…¬å¹³é” <code>FairSync</code> å’Œéå…¬å¹³é” <code>NonfairSync</code> ä¸¤ä¸ªå­ç±»ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/reentrantlock-class-diagram.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>ReentrantLock</code> é»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾å¼çš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// ä¼ å…¥ä¸€ä¸ª boolean å€¼ï¼Œtrue æ—¶ä¸ºå…¬å¹³é”ï¼Œfalse æ—¶ä¸ºéå…¬å¹³é”</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œ <code>ReentrantLock</code> çš„åº•å±‚å°±æ˜¯ç”± AQS æ¥å®ç°çš„ã€‚å…³äº AQS çš„ç›¸å…³å†…å®¹æ¨èé˜…è¯» <a href="https://javaguide.cn/java/concurrent/aqs.html" target="_blank" rel="noopener noreferrer">AQS è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¿™ç¯‡æ–‡ç« ã€‚</p><h3 id="å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰ä»€ä¹ˆåŒºåˆ«"><span>å…¬å¹³é”å’Œéå…¬å¹³é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><ul><li><strong>å…¬å¹³é”</strong> : é”è¢«é‡Šæ”¾ä¹‹åï¼Œå…ˆç”³è¯·çš„çº¿ç¨‹å…ˆå¾—åˆ°é”ã€‚æ€§èƒ½è¾ƒå·®ä¸€äº›ï¼Œå› ä¸ºå…¬å¹³é”ä¸ºäº†ä¿è¯æ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ›´é¢‘ç¹ã€‚</li><li><strong>éå…¬å¹³é”</strong>ï¼šé”è¢«é‡Šæ”¾ä¹‹åï¼Œåç”³è¯·çš„çº¿ç¨‹å¯èƒ½ä¼šå…ˆè·å–åˆ°é”ï¼Œæ˜¯éšæœºæˆ–è€…æŒ‰ç…§å…¶ä»–ä¼˜å…ˆçº§æ’åºçš„ã€‚æ€§èƒ½æ›´å¥½ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´æŸäº›çº¿ç¨‹æ°¸è¿œæ— æ³•è·å–åˆ°é”ã€‚</li></ul><h3 id="synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><h4 id="ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”" tabindex="-1"><a class="header-anchor" href="#ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”"><span>ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”</span></a></h4><p><strong>å¯é‡å…¥é”</strong> ä¹Ÿå«é€’å½’é”ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ï¼Œå¦‚æœæ˜¯ä¸å¯é‡å…¥é”çš„è¯ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚</p><p>JDK æä¾›çš„æ‰€æœ‰ç°æˆçš„ <code>Lock</code> å®ç°ç±»ï¼ŒåŒ…æ‹¬ <code>synchronized</code> å…³é”®å­—é”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ<code>method1()</code> å’Œ <code>method2()</code>éƒ½è¢« <code>synchronized</code> å…³é”®å­—ä¿®é¥°ï¼Œ<code>method1()</code>è°ƒç”¨äº†<code>method2()</code>ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–¹æ³•1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–¹æ³•2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>synchronized</code>é”æ˜¯å¯é‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨<code>method1()</code> æ—¶å¯ä»¥ç›´æ¥è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼Œæ‰§è¡Œ <code>method2()</code> çš„æ—¶å€™å¯ä»¥å†æ¬¡è·å–è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œä¸ä¼šäº§ç”Ÿæ­»é”é—®é¢˜ã€‚å‡å¦‚<code>synchronized</code>æ˜¯ä¸å¯é‡å…¥é”çš„è¯ï¼Œç”±äºè¯¥å¯¹è±¡çš„é”å·²è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ä¸”æ— æ³•é‡Šæ”¾ï¼Œè¿™å°±å¯¼è‡´çº¿ç¨‹åœ¨æ‰§è¡Œ <code>method2()</code>æ—¶è·å–é”å¤±è´¥ï¼Œä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p><h4 id="synchronized-ä¾èµ–äº-jvm-è€Œ-reentrantlock-ä¾èµ–äº-api" tabindex="-1"><a class="header-anchor" href="#synchronized-ä¾èµ–äº-jvm-è€Œ-reentrantlock-ä¾èµ–äº-api"><span>synchronized ä¾èµ–äº JVM è€Œ ReentrantLock ä¾èµ–äº API</span></a></h4><p><code>synchronized</code> æ˜¯ä¾èµ–äº JVM å®ç°çš„ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº† è™šæ‹Ÿæœºå›¢é˜Ÿåœ¨ JDK1.6 ä¸º <code>synchronized</code> å…³é”®å­—è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä½†æ˜¯è¿™äº›ä¼˜åŒ–éƒ½æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ç»™æˆ‘ä»¬ã€‚</p><p><code>ReentrantLock</code> æ˜¯ JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°±æ˜¯ API å±‚é¢ï¼Œéœ€è¦ lock() å’Œ unlock() æ–¹æ³•é…åˆ try/finally è¯­å¥å—æ¥å®Œæˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å®ƒçš„æºä»£ç ï¼Œæ¥çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h4 id="reentrantlock-æ¯”-synchronized-å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#reentrantlock-æ¯”-synchronized-å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½"><span>ReentrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½</span></a></h4><p>ç›¸æ¯”<code>synchronized</code>ï¼Œ<code>ReentrantLock</code>å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ä¸»è¦æ¥è¯´ä¸»è¦æœ‰ä¸‰ç‚¹ï¼š</p><ul><li><strong>ç­‰å¾…å¯ä¸­æ–­</strong> : <code>ReentrantLock</code>æä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡ <code>lock.lockInterruptibly()</code> æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚</li><li><strong>å¯å®ç°å…¬å¹³é”</strong> : <code>ReentrantLock</code>å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œ<code>synchronized</code>åªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚<code>ReentrantLock</code>é»˜è®¤æƒ…å†µæ˜¯éå…¬å¹³çš„ï¼Œå¯ä»¥é€šè¿‡ <code>ReentrantLock</code>ç±»çš„<code>ReentrantLock(boolean fair)</code>æ„é€ æ–¹æ³•æ¥æŒ‡å®šæ˜¯å¦æ˜¯å…¬å¹³çš„ã€‚</li><li><strong>å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰</strong>: <code>synchronized</code>å…³é”®å­—ä¸<code>wait()</code>å’Œ<code>notify()</code>/<code>notifyAll()</code>æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚<code>ReentrantLock</code>ç±»å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äº<code>Condition</code>æ¥å£ä¸<code>newCondition()</code>æ–¹æ³•ã€‚</li></ul><p>å¦‚æœä½ æƒ³ä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œé‚£ä¹ˆé€‰æ‹© <code>ReentrantLock</code> æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>å…³äº <code>Condition</code>æ¥å£çš„è¡¥å……ï¼š</p><blockquote><p><code>Condition</code>æ˜¯ JDK1.5 ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ª<code>Lock</code>å¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ª<code>Condition</code>å®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§†å™¨ï¼‰ï¼Œ<strong>çº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„<code>Condition</code>ä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµæ´»ã€‚ åœ¨ä½¿ç”¨<code>notify()/notifyAll()</code>æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œç”¨<code>ReentrantLock</code>ç±»ç»“åˆ<code>Condition</code>å®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€</strong> ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯ <code>Condition</code> æ¥å£é»˜è®¤æä¾›çš„ã€‚è€Œ<code>synchronized</code>å…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ª <code>Lock</code> å¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ª<code>Condition</code>å®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒä¸€ä¸ªèº«ä¸Šã€‚å¦‚æœæ‰§è¡Œ<code>notifyAll()</code>æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ã€‚è€Œ<code>Condition</code>å®ä¾‹çš„<code>signalAll()</code>æ–¹æ³•ï¼Œåªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥<code>Condition</code>å®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚</p></blockquote><h3 id="å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”æœ‰ä»€ä¹ˆåŒºåˆ«"><span>å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><ul><li><strong>å¯ä¸­æ–­é”</strong>ï¼šè·å–é”çš„è¿‡ç¨‹ä¸­å¯ä»¥è¢«ä¸­æ–­ï¼Œä¸éœ€è¦ä¸€ç›´ç­‰åˆ°è·å–é”ä¹‹å æ‰èƒ½è¿›è¡Œå…¶ä»–é€»è¾‘å¤„ç†ã€‚<code>ReentrantLock</code> å°±å±äºæ˜¯å¯ä¸­æ–­é”ã€‚</li><li><strong>ä¸å¯ä¸­æ–­é”</strong>ï¼šä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±åªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†ã€‚ <code>synchronized</code> å°±å±äºæ˜¯ä¸å¯ä¸­æ–­é”ã€‚</li></ul><h2 id="reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelock"><span>ReentrantReadWriteLock</span></a></h2><p><code>ReentrantReadWriteLock</code> åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„å¹¶ä¸å¤šï¼Œé¢è¯•ä¸­ä¹Ÿé—®çš„æ¯”è¾ƒå°‘ï¼Œç®€å•äº†è§£å³å¯ã€‚JDK 1.8 å¼•å…¥äº†æ€§èƒ½æ›´å¥½çš„è¯»å†™é” <code>StampedLock</code> ã€‚</p><h3 id="reentrantreadwritelock-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelock-æ˜¯ä»€ä¹ˆ"><span>ReentrantReadWriteLock æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p><code>ReentrantReadWriteLock</code> å®ç°äº† <code>ReadWriteLock</code> ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„è¯»å†™é”ï¼Œæ—¢å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ•ˆç‡ï¼ŒåŒæ—¶åˆå¯ä»¥ä¿è¯æœ‰å†™å…¥æ“ä½œæ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantReadWriteLock</span>
        <span class="token keyword">implements</span> <span class="token class-name">ReadWriteLock</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadWriteLock</span> <span class="token punctuation">{</span>
    <span class="token class-name">Lock</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸€èˆ¬é”è¿›è¡Œå¹¶å‘æ§åˆ¶çš„è§„åˆ™ï¼šè¯»è¯»äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥ã€‚</li><li>è¯»å†™é”è¿›è¡Œå¹¶å‘æ§åˆ¶çš„è§„åˆ™ï¼šè¯»è¯»ä¸äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥ï¼ˆåªæœ‰è¯»è¯»ä¸äº’æ–¥ï¼‰ã€‚</li></ul><p><code>ReentrantReadWriteLock</code> å…¶å®æ˜¯ä¸¤æŠŠé”ï¼Œä¸€æŠŠæ˜¯ <code>WriteLock</code> (å†™é”)ï¼Œä¸€æŠŠæ˜¯ <code>ReadLock</code>ï¼ˆè¯»é”ï¼‰ ã€‚è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬å é”ã€‚è¯»é”å¯ä»¥è¢«åŒæ—¶è¯»ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œå†™é”æœ€å¤šåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</p><p>å’Œ <code>ReentrantLock</code> ä¸€æ ·ï¼Œ<code>ReentrantReadWriteLock</code> åº•å±‚ä¹Ÿæ˜¯åŸºäº AQS å®ç°çš„ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/reentrantreadwritelock-class-diagram.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>ReentrantReadWriteLock</code> ä¹Ÿæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œé»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// ä¼ å…¥ä¸€ä¸ª boolean å€¼ï¼Œtrue æ—¶ä¸ºå…¬å¹³é”ï¼Œfalse æ—¶ä¸ºéå…¬å¹³é”</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readerLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReadLock</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writerLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WriteLock</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="reentrantreadwritelock-é€‚åˆä»€ä¹ˆåœºæ™¯" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelock-é€‚åˆä»€ä¹ˆåœºæ™¯"><span>ReentrantReadWriteLock é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</span></a></h3><p>ç”±äº <code>ReentrantReadWriteLock</code> æ—¢å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ•ˆç‡ï¼ŒåŒæ—¶åˆå¯ä»¥ä¿è¯æœ‰å†™å…¥æ“ä½œæ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚å› æ­¤ï¼Œåœ¨è¯»å¤šå†™å°‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>ReentrantReadWriteLock</code> èƒ½å¤Ÿæ˜æ˜¾æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><h3 id="å…±äº«é”å’Œç‹¬å é”æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#å…±äº«é”å’Œç‹¬å é”æœ‰ä»€ä¹ˆåŒºåˆ«"><span>å…±äº«é”å’Œç‹¬å é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><ul><li><strong>å…±äº«é”</strong>ï¼šä¸€æŠŠé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—ã€‚</li><li><strong>ç‹¬å é”</strong>ï¼šä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚</li></ul><h3 id="çº¿ç¨‹æŒæœ‰è¯»é”è¿˜èƒ½è·å–å†™é”å—" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æŒæœ‰è¯»é”è¿˜èƒ½è·å–å†™é”å—"><span>çº¿ç¨‹æŒæœ‰è¯»é”è¿˜èƒ½è·å–å†™é”å—ï¼Ÿ</span></a></h3><ul><li>åœ¨çº¿ç¨‹æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹ï¼Œè¯¥çº¿ç¨‹ä¸èƒ½å–å¾—å†™é”(å› ä¸ºè·å–å†™é”çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å½“å‰çš„è¯»é”è¢«å ç”¨ï¼Œå°±é©¬ä¸Šè·å–å¤±è´¥ï¼Œä¸ç®¡è¯»é”æ˜¯ä¸æ˜¯è¢«å½“å‰çº¿ç¨‹æŒæœ‰)ã€‚</li><li>åœ¨çº¿ç¨‹æŒæœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­è·å–è¯»é”ï¼ˆè·å–è¯»é”æ—¶å¦‚æœå‘ç°å†™é”è¢«å ç”¨ï¼Œåªæœ‰å†™é”æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹å ç”¨çš„æƒ…å†µæ‰ä¼šè·å–å¤±è´¥ï¼‰ã€‚</li></ul><p>è¯»å†™é”çš„æºç åˆ†æï¼Œæ¨èé˜…è¯» <a href="https://mp.weixin.qq.com/s/h3VIUyH9L0v14MrQJiiDbw" target="_blank" rel="noopener noreferrer">èŠèŠ Java çš„å‡ æŠŠ JVM çº§é” - é˜¿é‡Œå·´å·´ä¸­é—´ä»¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¿™ç¯‡æ–‡ç« ï¼Œå†™çš„å¾ˆä¸é”™ã€‚</p><h3 id="è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”" tabindex="-1"><a class="header-anchor" href="#è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”"><span>è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”ï¼Ÿ</span></a></h3><p>å†™é”å¯ä»¥é™çº§ä¸ºè¯»é”ï¼Œä½†æ˜¯è¯»é”å´ä¸èƒ½å‡çº§ä¸ºå†™é”ã€‚è¿™æ˜¯å› ä¸ºè¯»é”å‡çº§ä¸ºå†™é”ä¼šå¼•èµ·çº¿ç¨‹çš„äº‰å¤ºï¼Œæ¯•ç«Ÿå†™é”å±äºæ˜¯ç‹¬å é”ï¼Œè¿™æ ·çš„è¯ï¼Œä¼šå½±å“æ€§èƒ½ã€‚</p><p>å¦å¤–ï¼Œè¿˜å¯èƒ½ä¼šæœ‰æ­»é”é—®é¢˜å‘ç”Ÿã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä¸¤ä¸ªçº¿ç¨‹çš„è¯»é”éƒ½æƒ³å‡çº§å†™é”ï¼Œåˆ™éœ€è¦å¯¹æ–¹éƒ½é‡Šæ”¾è‡ªå·±é”ï¼Œè€ŒåŒæ–¹éƒ½ä¸é‡Šæ”¾ï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ã€‚</p><h2 id="stampedlock" tabindex="-1"><a class="header-anchor" href="#stampedlock"><span>StampedLock</span></a></h2><p><code>StampedLock</code> é¢è¯•ä¸­é—®çš„æ¯”è¾ƒå°‘ï¼Œä¸æ˜¯å¾ˆé‡è¦ï¼Œç®€å•äº†è§£å³å¯ã€‚</p><h3 id="stampedlock-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#stampedlock-æ˜¯ä»€ä¹ˆ"><span>StampedLock æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p><code>StampedLock</code> æ˜¯ JDK 1.8 å¼•å…¥çš„æ€§èƒ½æ›´å¥½çš„è¯»å†™é”ï¼Œä¸å¯é‡å…¥ä¸”ä¸æ”¯æŒæ¡ä»¶å˜é‡ <code>Condition</code>ã€‚</p><p>ä¸åŒäºä¸€èˆ¬çš„ <code>Lock</code> ç±»ï¼Œ<code>StampedLock</code> å¹¶ä¸æ˜¯ç›´æ¥å®ç° <code>Lock</code>æˆ– <code>ReadWriteLock</code>æ¥å£ï¼Œè€Œæ˜¯åŸºäº <strong>CLH é”</strong> ç‹¬ç«‹å®ç°çš„ï¼ˆAQS ä¹Ÿæ˜¯åŸºäºè¿™ç©æ„ï¼‰ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StampedLock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>StampedLock</code> æä¾›äº†ä¸‰ç§æ¨¡å¼çš„è¯»å†™æ§åˆ¶æ¨¡å¼ï¼šè¯»é”ã€å†™é”å’Œä¹è§‚è¯»ã€‚</p><ul><li><strong>å†™é”</strong>ï¼šç‹¬å é”ï¼Œä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”åï¼Œå…¶ä»–è¯·æ±‚è¯»é”å’Œå†™é”çš„çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚ç±»ä¼¼äº <code>ReentrantReadWriteLock</code> çš„å†™é”ï¼Œä¸è¿‡è¿™é‡Œçš„å†™é”æ˜¯ä¸å¯é‡å…¥çš„ã€‚</li><li><strong>è¯»é”</strong> ï¼ˆæ‚²è§‚è¯»ï¼‰ï¼šå…±äº«é”ï¼Œæ²¡æœ‰çº¿ç¨‹è·å–å†™é”çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰è¯»é”ã€‚å¦‚æœå·±ç»æœ‰çº¿ç¨‹æŒæœ‰å†™é”ï¼Œåˆ™å…¶ä»–çº¿ç¨‹è¯·æ±‚è·å–è¯¥è¯»é”ä¼šè¢«é˜»å¡ã€‚ç±»ä¼¼äº <code>ReentrantReadWriteLock</code> çš„è¯»é”ï¼Œä¸è¿‡è¿™é‡Œçš„è¯»é”æ˜¯ä¸å¯é‡å…¥çš„ã€‚</li><li><strong>ä¹è§‚è¯»</strong>ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹è·å–ä¹è§‚è¯»ä»¥åŠè¯»é”ã€‚åŒæ—¶å…è®¸ä¸€ä¸ªå†™çº¿ç¨‹è·å–å†™é”ã€‚</li></ul><p>å¦å¤–ï¼Œ<code>StampedLock</code> è¿˜æ”¯æŒè¿™ä¸‰ç§é”åœ¨ä¸€å®šæ¡ä»¶ä¸‹è¿›è¡Œç›¸äº’è½¬æ¢ ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">long</span> <span class="token function">tryConvertToWriteLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> stamp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">long</span> <span class="token function">tryConvertToReadLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> stamp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">long</span> <span class="token function">tryConvertToOptimisticRead</span><span class="token punctuation">(</span><span class="token keyword">long</span> stamp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>StampedLock</code> åœ¨è·å–é”çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ª long å‹çš„æ•°æ®æˆ³ï¼Œè¯¥æ•°æ®æˆ³ç”¨äºç¨åçš„é”é‡Šæ”¾å‚æ•°ï¼Œå¦‚æœè¿”å›çš„æ•°æ®æˆ³ä¸º 0 åˆ™è¡¨ç¤ºé”è·å–å¤±è´¥ã€‚å½“å‰çº¿ç¨‹æŒæœ‰äº†é”å†æ¬¡è·å–é”è¿˜æ˜¯ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®æˆ³ï¼Œè¿™ä¹Ÿæ˜¯<code>StampedLock</code>ä¸å¯é‡å…¥çš„åŸå› ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// å†™é”</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> s<span class="token punctuation">,</span> next<span class="token punctuation">;</span>  <span class="token comment">// bypass acquireWrite in fully unlocked case only</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> state<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token constant">ABITS</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0L</span> <span class="token operator">&amp;&amp;</span>
             <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">STATE</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> next <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token constant">WBIT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span>
            next <span class="token operator">:</span> <span class="token function">acquireWrite</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// è¯»é”</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> s <span class="token operator">=</span> state<span class="token punctuation">,</span> next<span class="token punctuation">;</span>  <span class="token comment">// bypass acquireRead on common uncontended case</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>whead <span class="token operator">==</span> wtail <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">&amp;</span> <span class="token constant">ABITS</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">RFULL</span> <span class="token operator">&amp;&amp;</span>
             <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">STATE</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> next <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token constant">RUNIT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span>
            next <span class="token operator">:</span> <span class="token function">acquireRead</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¹è§‚è¯»</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> s<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> state<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token constant">WBIT</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>s <span class="token operator">&amp;</span> <span class="token constant">SBITS</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0L</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="stampedlock-çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ›´å¥½" tabindex="-1"><a class="header-anchor" href="#stampedlock-çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ›´å¥½"><span>StampedLock çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ›´å¥½ï¼Ÿ</span></a></h3><p>ç›¸æ¯”äºä¼ ç»Ÿè¯»å†™é”å¤šå‡ºæ¥çš„ä¹è§‚è¯»æ˜¯<code>StampedLock</code>æ¯” <code>ReadWriteLock</code> æ€§èƒ½æ›´å¥½çš„å…³é”®åŸå› ã€‚<code>StampedLock</code> çš„ä¹è§‚è¯»å…è®¸ä¸€ä¸ªå†™çº¿ç¨‹è·å–å†™é”ï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´æ‰€æœ‰å†™çº¿ç¨‹é˜»å¡ï¼Œä¹Ÿå°±æ˜¯å½“è¯»å¤šå†™å°‘çš„æ—¶å€™ï¼Œå†™çº¿ç¨‹æœ‰æœºä¼šè·å–å†™é”ï¼Œå‡å°‘äº†çº¿ç¨‹é¥¥é¥¿çš„é—®é¢˜ï¼Œååé‡å¤§å¤§æé«˜ã€‚</p><h3 id="stampedlock-é€‚åˆä»€ä¹ˆåœºæ™¯" tabindex="-1"><a class="header-anchor" href="#stampedlock-é€‚åˆä»€ä¹ˆåœºæ™¯"><span>StampedLock é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</span></a></h3><p>å’Œ <code>ReentrantReadWriteLock</code> ä¸€æ ·ï¼Œ<code>StampedLock</code> åŒæ ·é€‚åˆè¯»å¤šå†™å°‘çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥ä½œä¸º <code>ReentrantReadWriteLock</code>çš„æ›¿ä»£å“ï¼Œæ€§èƒ½æ›´å¥½ã€‚</p><p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>StampedLock</code>ä¸å¯é‡å…¥ï¼Œä¸æ”¯æŒæ¡ä»¶å˜é‡ <code>Condition</code>ï¼Œå¯¹ä¸­æ–­æ“ä½œæ”¯æŒä¹Ÿä¸å‹å¥½ï¼ˆä½¿ç”¨ä¸å½“å®¹æ˜“å¯¼è‡´ CPU é£™å‡ï¼‰ã€‚å¦‚æœä½ éœ€è¦ç”¨åˆ° <code>ReentrantLock</code> çš„ä¸€äº›é«˜çº§æ€§èƒ½ï¼Œå°±ä¸å¤ªå»ºè®®ä½¿ç”¨ <code>StampedLock</code> äº†ã€‚</p><p>å¦å¤–ï¼Œ<code>StampedLock</code> æ€§èƒ½è™½å¥½ï¼Œä½†ä½¿ç”¨èµ·æ¥ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ï¼Œä¸€æ—¦ä½¿ç”¨ä¸å½“ï¼Œå°±ä¼šå‡ºç°ç”Ÿäº§é—®é¢˜ã€‚å¼ºçƒˆå»ºè®®ä½ åœ¨ä½¿ç”¨<code>StampedLock</code> ä¹‹å‰ï¼Œçœ‹çœ‹ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/StampedLock.html" target="_blank" rel="noopener noreferrer">StampedLock å®˜æ–¹æ–‡æ¡£ä¸­çš„æ¡ˆä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h3 id="stampedlock-çš„åº•å±‚åŸç†äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#stampedlock-çš„åº•å±‚åŸç†äº†è§£å—"><span>StampedLock çš„åº•å±‚åŸç†äº†è§£å—ï¼Ÿ</span></a></h3><p><code>StampedLock</code> ä¸æ˜¯ç›´æ¥å®ç° <code>Lock</code>æˆ– <code>ReadWriteLock</code>æ¥å£ï¼Œè€Œæ˜¯åŸºäº <strong>CLH é”</strong> å®ç°çš„ï¼ˆAQS ä¹Ÿæ˜¯åŸºäºè¿™ç©æ„ï¼‰ï¼ŒCLH é”æ˜¯å¯¹è‡ªæ—‹é”çš„ä¸€ç§æ”¹è‰¯ï¼Œæ˜¯ä¸€ç§éšå¼çš„é“¾è¡¨é˜Ÿåˆ—ã€‚<code>StampedLock</code> é€šè¿‡ CLH é˜Ÿåˆ—è¿›è¡Œçº¿ç¨‹çš„ç®¡ç†ï¼Œé€šè¿‡åŒæ­¥çŠ¶æ€å€¼ <code>state</code> æ¥è¡¨ç¤ºé”çš„çŠ¶æ€å’Œç±»å‹ã€‚</p><p><code>StampedLock</code> çš„åŸç†å’Œ AQS åŸç†æ¯”è¾ƒç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://javaguide.cn/java/concurrent/aqs.html" target="_blank" rel="noopener noreferrer">AQS è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000015808032" target="_blank" rel="noopener noreferrer">StampedLock åº•å±‚åŸç†åˆ†æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>å¦‚æœä½ åªæ˜¯å‡†å¤‡é¢è¯•çš„è¯ï¼Œå»ºè®®å¤šèŠ±ç‚¹ç²¾åŠ›ææ‡‚ AQS åŸç†å³å¯ï¼Œ<code>StampedLock</code> åº•å±‚åŸç†åœ¨é¢è¯•ä¸­é‡åˆ°çš„æ¦‚ç‡éå¸¸å°ã€‚</p><h2 id="atomic-åŸå­ç±»" tabindex="-1"><a class="header-anchor" href="#atomic-åŸå­ç±»"><span>Atomic åŸå­ç±»</span></a></h2><p>Atomic åŸå­ç±»éƒ¨åˆ†çš„å†…å®¹æˆ‘å•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ï¼š<a class="route-link" href="/java/concurrent/atomic-classes.html">Atomic åŸå­ç±»æ€»ç»“</a> ã€‚</p><h2 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ"><span>å‚è€ƒ</span></a></h2><ul><li>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</li><li>ã€Šå®æˆ˜ Java é«˜å¹¶å‘ç¨‹åºè®¾è®¡ã€‹</li><li>Guide to the Volatile Keyword in Java - Baeldungï¼š<a href="https://www.baeldung.com/java-volatile" target="_blank" rel="noopener noreferrer">https://www.baeldung.com/java-volatile<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>ä¸å¯ä¸è¯´çš„ Javaâ€œé”â€äº‹ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼š<a href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2018/11/15/java-lock.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>åœ¨ ReadWriteLock ç±»ä¸­è¯»é”ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ä¸ºå†™é”ï¼Ÿï¼š<a href="https://cloud.tencent.com/developer/article/1176230" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1176230<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>é«˜æ€§èƒ½è§£å†³çº¿ç¨‹é¥¥é¥¿çš„åˆ©å™¨ StampedLockï¼š<a href="https://mp.weixin.qq.com/s/2Acujjr4BHIhlFsCLGwYSg" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/2Acujjr4BHIhlFsCLGwYSg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>ç†è§£ Java ä¸­çš„ ThreadLocal - æŠ€æœ¯å°é»‘å±‹ï¼š<a href="https://droidyue.com/blog/2016/03/13/learning-threadlocal-in-java/" target="_blank" rel="noopener noreferrer">https://droidyue.com/blog/2016/03/13/learning-threadlocal-in-java/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>ThreadLocal (Java Platform SE 8 ) - Oracle Help Centerï¼š<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ByteInvoker/edit/main/src/java/concurrent/java-concurrent-questions-02.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: yadonglu@caixin.com">Invoker</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/java/concurrent/java-concurrent-questions-01.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰</div></a><a class="route-link nav-link next" href="/java/concurrent/java-concurrent-questions-03.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Invokerçš„å­¦ä¹ ç¬”è®°</div><div class="vp-copyright">Copyright Â© 2024 Invoker </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Diq65XQm.js" defer></script>
  </body>
</html>
